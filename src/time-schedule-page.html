<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">

<link rel="import" href="shared-styles.html">


<dom-module id="summit-time-schedule">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      :host .card {
        padding: 10px;
        text-align: center;
        margin: 0px;
      }


      iron-list {
        --iron-list-items-container: {
          max-width: 800px;
          margin: auto;
          margin-top: 10px;
          margin-bottom: 10px;
          border-bottom: 1px solid #ddd;
        };
      }
      .item {
        @apply(--layout-horizontal);
        padding: 20px;
        background-color: white;
        border: 1px solid #ddd;
        cursor: pointer;
        margin-bottom: 1px;
      }
      .avatar {
        height: 50px;
        width: 50px;
        box-sizing: border-box;
        background-color: #DDD;
      }
      .pad {
        padding: 0 16px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .primary {
        font-size: 16px;
        font-weight: bold;
      }
      .shortText, .longText {
        font-size: 14px;
      }
      .longText {
        color: gray;
        display: none;
      }
      .item:hover .shortText::after {
        content: ' [+]';
        color: gray;
      }
      .item.expanded:hover .shortText::after {
        content: '';
      }
      .item.expanded .longText {
        display: block;
      }
      .item.expanded:hover .longText::after {
        content: ' [â€“]';
      }

      .avatar .hour {
        vertical-align: middle;
        display: inline-block;
        text-align: center;
        width: 100%;
      }

      .label-lecture {

      }
      .avatar-lecture {

      }
    </style>


    <div class$="[[_classForDay(day)]]"><h1>[[day.name]]</h1></div>

    <iron-list id="list" items="[[_getTimeSlots(eventData, currentProfile)]]" as="item" selection-enabled multi-selection>
       <template>
         <div>
           <div class$="[[_classForItem(item, selected)]]">

             <div class="avatar">
               <span class="hour">[[item.startTime]]</span>
               <span class="hour">(icon)</span>
             </div>

             <div class="pad">
               <div class="primary">[[item.name]]</div>

               <template is="dom-if" if="{{!_hasLongDescription(item)}}">
                 <div class="shortTextOnly">[[_getShortDescription(item)]]</div>
               </template>

               <template is="dom-if" if="{{_hasLongDescription(item)}}">
                 <template is="dom-if" if="{{!selected}}">
                   <div class="shortText">[[_getShortDescription(item)]]</div>
                 </template>

                <div class="longText">[[item.description]]</div>
              </template>

             </div>
           </div>
         </div>
       </template>
    </iron-list>


  </template>

  <script>

    (function() {

      var SHORT_DESC_MAX = 50;

      Polymer({
        is: 'summit-time-schedule',

        properties: {
          eventData: {
            type: Object,
            value: {},
          },
          currentProfile: {
            type: Object,
          },
          day: {
            type: Object,
            computed: '_getDay(eventData, currentProfile)',
          }
        },

        // needed for iron-list
        attached: function() {
          // Use the document element
          this.$.list.scrollTarget = this.ownerDocument.documentElement;
        },

        ////////////////////////////////////////////////////

        _getDay: function(eventData, profile) {
          if (!eventData.days) {
            return {};
          }
          return eventData.days
            .filter(function(day) {
              return day.id === profile.day;
            })[0] || {};
        },

        _getTimeSlots: function(eventData, profile) {
          if (!eventData.timeSlots) {
            return [];
          }
          return eventData.timeSlots
            .filter(function(timeSlot) {
              return timeSlot.onDay === profile.day;
            })
            .filter(function(timeSlot) {
                return !timeSlot.stream || timeSlot.stream === profile.stream;
            });
        },


        ////////////////////////////////////////////////////

        _classForItem: function(item, selected) {
          return selected ? 'item expanded' : 'item';
        },

        _classForDay: function(day) {
          return 'card day-' + day.id;
        },

        ////////////////////////////////////////////////////

        _getShortDescription: function(timeSlot) {
          if (!timeSlot.description){
            return "";
          }
          var suffix = this._hasLongDescription(timeSlot) ? '...' : '';
          return timeSlot.description.substring(0, SHORT_DESC_MAX) + suffix;
        },

        _hasLongDescription: function(timeSlot) {
          if (!timeSlot.description){
            return false;
          }
          return timeSlot.description.length > SHORT_DESC_MAX;
        },

      });
    })();
  </script>
</dom-module>
